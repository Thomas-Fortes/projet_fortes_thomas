<div class="page-container fade-in">
  <!-- Page Header -->
  <div class="page-header">
    <div class="header-content">
      <div class="header-icon" [class.favorites-icon]="showFavoritesOnly">
        <svg *ngIf="!showFavoritesOnly" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor">
          <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-1 17.93c-3.95-.49-7-3.85-7-7.93 0-.62.08-1.21.21-1.79L9 15v1c0 1.1.9 2 2 2v1.93zm6.9-2.54c-.26-.81-1-1.39-1.9-1.39h-1v-3c0-.55-.45-1-1-1H8v-2h2c.55 0 1-.45 1-1V7h2c1.1 0 2-.9 2-2v-.41c2.93 1.19 5 4.06 5 7.41 0 2.08-.8 3.97-2.1 5.39z"/>
        </svg>
        <svg *ngIf="showFavoritesOnly" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor">
          <path d="M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z"/>
        </svg>
      </div>
      <div>
        <h1>{{ showFavoritesOnly ? 'Mes Favoris' : 'Signalements' }}</h1>
        <p class="header-subtitle">
          {{ showFavoritesOnly ? 'Les pollutions que vous avez sauvegardees' : 'Ensemble, surveillons notre environnement' }}
        </p>
      </div>
    </div>
    <a *ngIf="!showFavoritesOnly && (isAuthenticated$ | async)" routerLink="/pollutions/new" class="btn btn-primary btn-lg">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" width="20" height="20">
        <path d="M19 13h-6v6h-2v-6H5v-2h6V5h2v6h6v2z"/>
      </svg>
      Signaler une pollution
    </a>
  </div>

  <!-- Filters Section -->
  <div class="filters-section" *ngIf="!showFavoritesOnly">
    <div class="search-wrapper">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" class="search-icon">
        <path d="M15.5 14h-.79l-.28-.27C15.41 12.59 16 11.11 16 9.5 16 5.91 13.09 3 9.5 3S3 5.91 3 9.5 5.91 16 9.5 16c1.61 0 3.09-.59 4.23-1.57l.27.28v.79l5 4.99L20.49 19l-4.99-5zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14z"/>
      </svg>
      <input
        type="text"
        [(ngModel)]="searchTerm"
        (ngModelChange)="onSearchChange()"
        placeholder="Rechercher par titre, description ou localisation..."
        class="search-input"
      />
      <button *ngIf="searchTerm" class="search-clear" (click)="searchTerm = ''; onSearchChange()">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor">
          <path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/>
        </svg>
      </button>
    </div>

    <div class="filters-row">
      <div class="filter-group">
        <label class="filter-label">Type</label>
        <select [(ngModel)]="selectedType" (ngModelChange)="onSearchChange()" class="filter-select">
          <option value="">Tous les types</option>
          <option *ngFor="let type of types" [value]="type">{{ getTypeLabel(type) }}</option>
        </select>
      </div>

      <div class="filter-group">
        <label class="filter-label">Statut</label>
        <select [(ngModel)]="selectedStatut" (ngModelChange)="onSearchChange()" class="filter-select">
          <option value="">Tous les statuts</option>
          <option *ngFor="let statut of statuts" [value]="statut">{{ getStatutLabel(statut) }}</option>
        </select>
      </div>

      <button *ngIf="searchTerm || selectedType || selectedStatut" (click)="clearFilters()" class="btn btn-outline btn-sm">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" width="16" height="16">
          <path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/>
        </svg>
        Effacer les filtres
      </button>
    </div>

    <div class="results-info">
      <span class="results-count">{{ filteredPollutions.length }} signalement{{ filteredPollutions.length > 1 ? 's' : '' }}</span>
      <span class="results-separator" *ngIf="searchTerm || selectedType || selectedStatut">|</span>
      <span class="active-filters" *ngIf="searchTerm || selectedType || selectedStatut">
        Filtres actifs
      </span>
    </div>
  </div>

  <!-- Loading State -->
  <div *ngIf="loading" class="loading-state">
    <div class="spinner"></div>
    <p>Chargement des signalements...</p>
  </div>

  <!-- Error State -->
  <div *ngIf="error" class="error-state">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor">
      <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm1 15h-2v-2h2v2zm0-4h-2V7h2v6z"/>
    </svg>
    <p>{{ error }}</p>
    <button class="btn btn-primary" (click)="loadPollutions()">Reessayer</button>
  </div>

  <!-- Empty State -->
  <div *ngIf="!loading && !error && filteredPollutions.length === 0" class="empty-state">
    <div class="empty-icon">
      <svg *ngIf="showFavoritesOnly" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor">
        <path d="M16.5 3c-1.74 0-3.41.81-4.5 2.09C10.91 3.81 9.24 3 7.5 3 4.42 3 2 5.42 2 8.5c0 3.78 3.4 6.86 8.55 11.54L12 21.35l1.45-1.32C18.6 15.36 22 12.28 22 8.5 22 5.42 19.58 3 16.5 3zm-4.4 15.55l-.1.1-.1-.1C7.14 14.24 4 11.39 4 8.5 4 6.5 5.5 5 7.5 5c1.54 0 3.04.99 3.57 2.36h1.87C13.46 5.99 14.96 5 16.5 5c2 0 3.5 1.5 3.5 3.5 0 2.89-3.14 5.74-7.9 10.05z"/>
      </svg>
      <svg *ngIf="!showFavoritesOnly" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor">
        <path d="M20 6h-8l-2-2H4c-1.1 0-1.99.9-1.99 2L2 18c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V8c0-1.1-.9-2-2-2zm0 12H4V8h16v10z"/>
      </svg>
    </div>
    <h3>{{ showFavoritesOnly ? 'Aucun favori' : 'Aucun signalement' }}</h3>
    <p>{{ showFavoritesOnly ? 'Vous n\'avez pas encore ajoute de pollution en favoris.' : 'Aucune pollution ne correspond a vos criteres de recherche.' }}</p>
    <a *ngIf="showFavoritesOnly" routerLink="/pollutions" class="btn btn-primary">
      Voir les signalements
    </a>
    <button *ngIf="!showFavoritesOnly && (searchTerm || selectedType || selectedStatut)" (click)="clearFilters()" class="btn btn-primary">
      Effacer les filtres
    </button>
  </div>

  <!-- Pollutions Grid -->
  <div class="pollutions-grid" *ngIf="!loading && !error && filteredPollutions.length > 0">
    <article class="pollution-card" *ngFor="let pollution of filteredPollutions" (click)="viewDetails(pollution.id)">
      <!-- Card Image -->
      <div class="card-image">
        <img *ngIf="pollution.photo" [src]="apiUrl + '/uploads/' + pollution.photo" [alt]="pollution.titre" loading="lazy" />
        <div *ngIf="!pollution.photo" class="image-placeholder">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor">
            <path d="M21 19V5c0-1.1-.9-2-2-2H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2zM8.5 13.5l2.5 3.01L14.5 12l4.5 6H5l3.5-4.5z"/>
          </svg>
        </div>
        <span class="status-badge" [ngClass]="getStatusClass(pollution.statut)">
          {{ getStatutLabel(pollution.statut) }}
        </span>
      </div>

      <!-- Card Content -->
      <div class="card-content">
        <div class="card-meta">
          <span class="type-badge">{{ getTypeLabel(pollution.type) }}</span>
          <button
            class="favorite-btn"
            [class.is-favorite]="isFavorite(pollution.id)"
            (click)="toggleFavorite(pollution, $event)"
            [title]="isFavorite(pollution.id) ? 'Retirer des favoris' : 'Ajouter aux favoris'">
            <svg *ngIf="!isFavorite(pollution.id)" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor">
              <path d="M16.5 3c-1.74 0-3.41.81-4.5 2.09C10.91 3.81 9.24 3 7.5 3 4.42 3 2 5.42 2 8.5c0 3.78 3.4 6.86 8.55 11.54L12 21.35l1.45-1.32C18.6 15.36 22 12.28 22 8.5 22 5.42 19.58 3 16.5 3zm-4.4 15.55l-.1.1-.1-.1C7.14 14.24 4 11.39 4 8.5 4 6.5 5.5 5 7.5 5c1.54 0 3.04.99 3.57 2.36h1.87C13.46 5.99 14.96 5 16.5 5c2 0 3.5 1.5 3.5 3.5 0 2.89-3.14 5.74-7.9 10.05z"/>
            </svg>
            <svg *ngIf="isFavorite(pollution.id)" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor">
              <path d="M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z"/>
            </svg>
          </button>
        </div>

        <h3 class="card-title">{{ pollution.titre }}</h3>

        <div class="card-location">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor">
            <path d="M12 2C8.13 2 5 5.13 5 9c0 5.25 7 13 7 13s7-7.75 7-13c0-3.87-3.13-7-7-7zm0 9.5c-1.38 0-2.5-1.12-2.5-2.5s1.12-2.5 2.5-2.5 2.5 1.12 2.5 2.5-1.12 2.5-2.5 2.5z"/>
          </svg>
          <span>{{ pollution.localisation }}</span>
        </div>

        <p class="card-description">
          {{ pollution.description | slice:0:120 }}{{ pollution.description.length > 120 ? '...' : '' }}
        </p>

        <div class="card-footer">
          <div class="card-author" *ngIf="pollution.user">
            <div class="author-avatar">{{ pollution.user.prenom?.charAt(0) }}{{ pollution.user.nom?.charAt(0) }}</div>
            <span>{{ pollution.user.prenom }} {{ pollution.user.nom }}</span>
          </div>

          <div class="card-actions" *ngIf="canEdit(pollution)">
            <button class="action-btn edit" (click)="editPollution(pollution.id, $event)" title="Modifier">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor">
                <path d="M3 17.25V21h3.75L17.81 9.94l-3.75-3.75L3 17.25zM20.71 7.04c.39-.39.39-1.02 0-1.41l-2.34-2.34c-.39-.39-1.02-.39-1.41 0l-1.83 1.83 3.75 3.75 1.83-1.83z"/>
              </svg>
            </button>
            <button class="action-btn delete" (click)="deletePollution(pollution.id, $event)" title="Supprimer">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor">
                <path d="M6 19c0 1.1.9 2 2 2h8c1.1 0 2-.9 2-2V7H6v12zM19 4h-3.5l-1-1h-5l-1 1H5v2h14V4z"/>
              </svg>
            </button>
          </div>
        </div>
      </div>
    </article>
  </div>
</div>
