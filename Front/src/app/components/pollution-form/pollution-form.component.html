<div class="form-container">
  <h2>{{ isEditMode ? 'Modifier une pollution' : 'Signaler une pollution' }}</h2>

  <form [formGroup]="pollutionForm" (ngSubmit)="onSubmit()">
    <div class="form-group">
      <label for="titre">Titre *</label>
      <input
        type="text"
        id="titre"
        formControlName="titre"
        placeholder="Ex: Deversement de dechets"
        [class.error]="hasError('titre', 'required') || hasError('titre', 'minlength')"
      >
      <span class="error-message" *ngIf="hasError('titre', 'required')">
        Le titre est requis
      </span>
      <span class="error-message" *ngIf="hasError('titre', 'minlength')">
        Le titre doit contenir au moins 3 caracteres
      </span>
    </div>

    <div class="form-group">
      <label for="type">Type de pollution *</label>
      <select
        id="type"
        formControlName="type"
        [class.error]="hasError('type', 'required')"
      >
        <option value="">Selectionner un type</option>
        <option *ngFor="let type of typesPolluton" [value]="type">{{ getTypeLabel(type) }}</option>
      </select>
      <span class="error-message" *ngIf="hasError('type', 'required')">
        Le type est requis
      </span>
    </div>

    <div class="form-group">
      <label for="description">Description *</label>
      <textarea
        id="description"
        formControlName="description"
        rows="4"
        placeholder="Decrivez la pollution observee..."
        [class.error]="hasError('description', 'required') || hasError('description', 'minlength')"
      ></textarea>
      <span class="error-message" *ngIf="hasError('description', 'required')">
        La description est requise
      </span>
      <span class="error-message" *ngIf="hasError('description', 'minlength')">
        La description doit contenir au moins 10 caracteres
      </span>
    </div>

    <div class="form-group">
      <label for="localisation">Localisation *</label>
      <input
        type="text"
        id="localisation"
        formControlName="localisation"
        placeholder="Ex: Parc de la Villette, Paris"
        [class.error]="hasError('localisation', 'required')"
      >
      <span class="error-message" *ngIf="hasError('localisation', 'required')">
        La localisation est requise
      </span>
    </div>

    <div class="form-row">
      <div class="form-group">
        <label for="latitude">Latitude (optionnel)</label>
        <input
          type="number"
          id="latitude"
          formControlName="latitude"
          step="0.000001"
          placeholder="48.8566"
        >
      </div>

      <div class="form-group">
        <label for="longitude">Longitude (optionnel)</label>
        <input
          type="number"
          id="longitude"
          formControlName="longitude"
          step="0.000001"
          placeholder="2.3522"
        >
      </div>
    </div>

    <div class="form-group" *ngIf="isEditMode">
      <label for="statut">Statut</label>
      <select id="statut" formControlName="statut">
        <option *ngFor="let statut of statuts" [value]="statut">{{ getStatutLabel(statut) }}</option>
      </select>
    </div>

    <div class="form-group">
      <label>Photo (optionnel)</label>
      <div class="photo-upload">
        <input
          type="file"
          id="photo"
          accept="image/jpeg,image/png,image/gif,image/webp"
          (change)="onFileSelected($event)"
          #fileInput
        >
        <label for="photo" class="upload-btn">
          Choisir une image
        </label>

        <div *ngIf="currentPhotoUrl" class="photo-preview">
          <img [src]="currentPhotoUrl" alt="Preview" />
          <button type="button" class="btn-remove" (click)="removePhoto(); fileInput.value=''">
            Supprimer
          </button>
        </div>
      </div>
      <small class="hint">Formats acceptes: jpeg, png, gif, webp. Taille max: 5MB</small>
    </div>

    <div class="error-message submit-error" *ngIf="submitError">
      {{ submitError }}
    </div>

    <div class="form-actions">
      <button type="button" class="btn btn-secondary" (click)="cancel()" [disabled]="loading">
        Annuler
      </button>
      <button type="submit" class="btn btn-primary" [disabled]="loading">
        {{ loading ? 'En cours...' : (isEditMode ? 'Mettre a jour' : 'Signaler') }}
      </button>
    </div>
  </form>
</div>
